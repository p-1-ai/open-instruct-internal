{
    "version": "0.2.0",
    "configurations": [
        {
            "name": "Debug finetune_8b.sh",
            "type": "debugpy",
            "request": "launch",
            "program": "${workspaceFolder}/.venv/bin/accelerate",
            "args": [
                "launch",
                "--mixed_precision", "bf16",
                "--num_processes", "1",
                "--use_deepspeed",
                "--deepspeed_config_file", "configs/ds_configs/stage2_accelerate.conf",
                "--deepspeed_multinode_launcher", "standard",
                "open_instruct/finetune.py",
                "--exp_name", "tulu3_8b_sft",
                "--model_name_or_path", "meta-llama/Llama-3.1-8B", // "Qwen/Qwen3-0.6B",
                "--model_revision", "main",
                "--tokenizer_name", "meta-llama/Llama-3.1-8B",
                "--tokenizer_revision", "main",
                "--use_slow_tokenizer",
                "--chat_template_name", "r1_simple_chat_postpend_think",
                "--dataset_mixer_list", "allenai/tulu-3-sft-mixture", "512",
                "--max_seq_length", "512",
                "--per_device_train_batch_size", "1",
                "--gradient_accumulation_steps", "2",
                "--learning_rate", "5e-06",
                "--lr_scheduler_type", "linear",
                "--warmup_ratio", "0.03",
                "--weight_decay", "0.0",
                "--num_train_epochs", "2",
                "--output_dir", "/mnt/disks/ssd/tulu3_8b_sft",
                "--use_flash_attn",
                "--gradient_checkpointing",
                "--checkpointing_steps", "epoch",
                "--dataset_mix_dir", "/mnt/disks/ssd/tulu3_8b_sft",
                "--report_to", "wandb",
                "--with_tracking",
                "--logging_steps", "1",
                "--seed", "8"
            ],
            "console": "integratedTerminal",
            "cwd": "${workspaceFolder}",
            "env": {
                "TMPDIR": "/mnt/disks/ssd/tmp",
                "TMP": "/mnt/disks/ssd/tmp",
                "TEMP": "/mnt/disks/ssd/tmp",
                "UV_CACHE_DIR": "/mnt/disks/ssd/uv_cache",
                "NCCL_IB_DISABLE": "1",
                "NCCL_P2P_DISABLE": "1",
                "NCCL_SHM_DISABLE": "0",
                "NCCL_SHIM_DISABLE": "1",
                "NCCL_DEBUG": "INFO"
            },
            "envFile": "${workspaceFolder}/.env",
            "python": "${workspaceFolder}/.venv/bin/python",
            "justMyCode": false
        },
        {
            "name": "Debug finetune.py (direct, no accelerate)",
            "type": "debugpy",
            "request": "launch",
            "program": "${workspaceFolder}/open_instruct/finetune.py",
            "args": [
                "--exp_name", "tulu3_8b_sft",
                "--model_name_or_path", "meta-llama/Llama-3.1-8B",
                "--model_revision", "main",
                "--tokenizer_name", "meta-llama/Llama-3.1-8B",
                "--tokenizer_revision", "main",
                "--use_slow_tokenizer",
                "--chat_template", "tulu",
                "--dataset_mixer_list", "allenai/tulu-3-sft-mixture", "512",
                "--max_seq_length", "4096",
                "--per_device_train_batch_size", "1",
                "--gradient_accumulation_steps", "2",
                "--learning_rate", "5e-06",
                "--lr_scheduler_type", "linear",
                "--warmup_ratio", "0.03",
                "--weight_decay", "0.0",
                "--num_train_epochs", "2",
                "--output_dir", "/mnt/disks/ssd/tulu3_8b_sft",
                "--use_flash_attn",
                "--gradient_checkpointing",
                "--checkpointing_steps", "epoch",
                "--dataset_mix_dir", "/mnt/disks/ssd/tulu3_8b_sft",
                "--report_to", "wandb",
                "--with_tracking",
                "--logging_steps", "1",
                "--seed", "8"
            ],
            "console": "integratedTerminal",
            "cwd": "${workspaceFolder}",
            "env": {
                "TMPDIR": "/mnt/disks/ssd/tmp",
                "TMP": "/mnt/disks/ssd/tmp",
                "TEMP": "/mnt/disks/ssd/tmp",
                "UV_CACHE_DIR": "/mnt/disks/ssd/uv_cache",
                "NCCL_IB_DISABLE": "1",
                "NCCL_P2P_DISABLE": "1",
                "NCCL_SHM_DISABLE": "0",
                "NCCL_SHIM_DISABLE": "1",
                "NCCL_DEBUG": "INFO",
                "WORLD_SIZE": "1",
                "RANK": "0",
                "LOCAL_RANK": "0",
                "MASTER_ADDR": "127.0.0.1",
                "MASTER_PORT": "29500"
            },
            "python": "${workspaceFolder}/.venv/bin/python",
            "justMyCode": false
        }
    ]
}

